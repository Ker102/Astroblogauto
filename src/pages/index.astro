---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import WorkflowTimeline from '../components/WorkflowTimeline';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const notionDatabaseUrl = 'https://www.notion.so/'; // replace with real link if desired
const repoUrl = 'https://github.com/Ker102/Astroblogauto';
const actionsUrl = `${repoUrl}/actions`;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`${SITE_TITLE} ‚Äî Automated Publishing`} description={SITE_DESCRIPTION} />
		<style>
			body {
				background: radial-gradient(circle at 0 0, rgba(var(--parchment), 0.4), transparent 45%),
					radial-gradient(circle at 100% 20%, rgba(var(--accent-rgb), 0.08), transparent 55%),
					linear-gradient(180deg, rgba(var(--paper), 0.95), rgba(var(--paper), 0.75));
			}
			main {
				width: min(1040px, 100%);
				margin: 0 auto;
				padding: clamp(1.5rem, 4vw, 3rem) clamp(1.25rem, 6vw, 4rem) 4rem;
				display: flex;
				flex-direction: column;
				gap: clamp(2.5rem, 6vw, 4rem);
			}
			.hero {
				display: grid;
				gap: clamp(1.5rem, 4vw, 2.5rem);
				align-items: start;
				background: rgba(var(--paper), 0.92);
				border-radius: 42px;
				padding: clamp(2rem, 6vw, 3.5rem);
				box-shadow: var(--shadow);
				border: 1px solid rgba(var(--gray), 0.1);
			}
			.hero h1 {
				margin: 0;
				font-size: clamp(2.25rem, 4vw, 3.5rem);
				color: rgb(var(--black));
				line-height: 1.2;
			}
			.hero p {
				margin: 0;
				font-size: 1.05rem;
				color: rgba(var(--gray-dark), 0.88);
				line-height: 1.8;
			}
			.hero ul {
				margin: 0;
				padding-left: 1.25rem;
				color: rgba(var(--gray-dark), 0.88);
				line-height: 1.7;
			}
			.hero .cta-row {
				display: flex;
				flex-wrap: wrap;
				gap: 0.75rem;
				margin-top: 1.5rem;
			}
			.hero a.cta {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.8rem 1.4rem;
				border-radius: 999px;
				background: rgb(var(--accent));
				color: white;
				text-decoration: none;
				font-weight: 600;
				transition: transform 120ms ease, box-shadow 120ms ease;
			}
			.hero a.cta.secondary {
				background: rgba(var(--accent-rgb), 0.12);
				color: var(--accent-dark);
			}
			.hero a.cta:hover {
				transform: translateY(-2px);
				box-shadow: 0 16px 30px rgba(var(--accent-rgb), 0.25);
			}
			.quick-facts {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
				gap: clamp(1rem, 3vw, 1.75rem);
			}
			.fact-card {
				background: rgba(var(--paper), 0.9);
				border-radius: 28px;
				padding: clamp(1.5rem, 4vw, 2rem);
				box-shadow: var(--shadow);
				border: 1px solid rgba(var(--gray), 0.08);
			}
			.fact-card h3 {
				margin: 0 0 0.75rem;
				font-size: 1.1rem;
				color: rgb(var(--black));
				display: flex;
				align-items: center;
				gap: 0.65rem;
			}
			.fact-card p,
			.fact-card ul {
				margin: 0;
				color: rgba(var(--gray-dark), 0.85);
				line-height: 1.7;
			}
			.fact-card ul {
				margin-top: 0.5rem;
				padding-left: 1.1rem;
			}
			.timeline-section {
				background: rgba(var(--paper), 0.92);
				border-radius: 42px;
				padding: clamp(2rem, 5vw, 3.5rem);
				box-shadow: var(--shadow);
				border: 1px solid rgba(var(--gray), 0.12);
			}
			.timeline-section h2 {
				margin: 0 0 1.25rem;
				font-size: clamp(2rem, 3vw, 2.5rem);
				color: rgb(var(--black));
			}
			.timeline-section > p {
				margin: 0 0 2rem;
				color: rgba(var(--gray-dark), 0.85);
				max-width: 720px;
				line-height: 1.8;
			}
			.timeline {
				display: flex;
				flex-direction: column;
				gap: clamp(1.25rem, 4vw, 2rem);
			}
			.timeline-step {
				display: grid;
				grid-template-columns: auto 1fr;
				gap: clamp(1rem, 3vw, 1.5rem);
				align-items: start;
			}
			.timeline-marker {
				position: relative;
				display: grid;
				place-items: center;
			}
			.timeline-marker span {
				width: 48px;
				height: 48px;
				border-radius: 999px;
				display: grid;
				place-items: center;
				font-size: 1.6rem;
				background: rgba(var(--accent-rgb), 0.12);
				color: var(--accent-dark);
				box-shadow: inset 0 0 0 2px rgba(var(--accent-rgb), 0.25);
			}
			.timeline-line {
				position: absolute;
				top: 52px;
				left: 50%;
				width: 2px;
				height: calc(100% - 52px);
				background: rgba(var(--accent-rgb), 0.25);
				transform: translateX(-50%);
			}
			.timeline-line[data-last='true'] {
				display: none;
			}
			.timeline-card {
				background: rgba(var(--paper), 0.98);
				border-radius: 26px;
				padding: clamp(1.25rem, 3vw, 2rem);
				box-shadow: var(--shadow);
				border: 1px solid rgba(var(--gray), 0.1);
			}
			.timeline-card h3 {
				margin: 0 0 0.4rem;
				font-size: 1.35rem;
				color: rgb(var(--black));
			}
			.timeline-card .step-badge {
				margin: 0 0 0.5rem;
				font-weight: 600;
				color: var(--accent-dark);
				text-transform: uppercase;
				letter-spacing: 0.12em;
				font-size: 0.75rem;
			}
			.timeline-card .summary {
				margin: 0 0 0.9rem;
				color: rgba(var(--gray-dark), 0.85);
			}
			.timeline-card ul {
				margin: 0;
				padding-left: 1.1rem;
				color: rgba(var(--gray-dark), 0.85);
				line-height: 1.65;
			}
			.deep-dive {
				display: grid;
				gap: clamp(1.5rem, 4vw, 2.5rem);
			}
			.deep-dive h2 {
				margin: 0;
				font-size: clamp(2rem, 3.2vw, 2.5rem);
				color: rgb(var(--black));
			}
			.deep-dive p {
				margin: 0;
				color: rgba(var(--gray-dark), 0.86);
				line-height: 1.8;
			}
			.deep-dive .grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
				gap: clamp(1rem, 3vw, 1.75rem);
			}
			.deep-card {
				background: rgba(var(--paper), 0.9);
				border-radius: 28px;
				padding: clamp(1.5rem, 4vw, 2rem);
				border: 1px solid rgba(var(--gray), 0.08);
				box-shadow: var(--shadow);
			}
			.deep-card h3 {
				margin: 0 0 0.6rem;
				color: rgb(var(--black));
				font-size: 1.15rem;
			}
			.deep-card p,
			.deep-card ul {
				margin: 0;
				color: rgba(var(--gray-dark), 0.85);
				line-height: 1.7;
			}
			.deep-card ul {
				margin-top: 0.5rem;
				padding-left: 1.1rem;
			}
			#blog {
				scroll-margin-top: 6rem;
			}
			@media (max-width: 640px) {
				.timeline-step {
					grid-template-columns: 1fr;
				}
				.timeline-marker {
					display: none;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="hero">
				<h1>Automated Notion ‚Üí GitHub Pages publishing</h1>
				<p>
					This blog runs on a frictionless pipeline: draft in Notion, mark the status as ‚ÄúReady to
					Publish‚Äù, and GitHub Actions handles the rest‚Äîconversion, commits, and deployment to
					GitHub Pages‚Äîwithout touching a terminal.
				</p>
				<p>
					The automation lets me stay focused on writing while guaranteeing every live article is
					versioned in git, rendered with Astro, and synced back to Notion for perfect record keeping.
				</p>
				<div class="cta-row">
					<a class="cta" href={actionsUrl} target="_blank" rel="noreferrer">
						View GitHub Actions run logs
					</a>
					<a class="cta secondary" href={repoUrl} target="_blank" rel="noreferrer">
						Browse the repository
					</a>
				</div>
				<ul>
					<li>
						Notion is the single source of truth‚Äîno editing in markdown folders or CMS dashboards.
					</li>
					<li>
						The publishing script enforces content rules (title, preview text, publish date, tags) so
						every article renders consistently.
					</li>
					<li>
						Deployment is fully automated with GitHub Pages; new commits instantly refresh the live
						site.
					</li>
				</ul>
			</section>

			<section class="quick-facts">
				<article class="fact-card">
					<h3>üóÇÔ∏è Notion database design</h3>
					<p>
						The Notion database stores each story with rich text blocks and these schema fields:
						<strong>Title</strong>, <strong>Preview Text</strong>, <strong>Publish Date</strong>,
						<strong>Tags</strong>, and a <strong>Status</strong> column.
					</p>
					<p>
						Only entries marked <em>Ready to Publish</em> are exported. The script refuses to publish
						drafts missing required metadata.
					</p>
				</article>
				<article class="fact-card">
					<h3>‚öôÔ∏è Actions that power it</h3>
					<ul>
						<li>
							<strong>Publish from Notion</strong> runs every 5 minutes. It converts qualifying pages into
							Markdown and commits them via Octokit.
						</li>
						<li>
							<strong>Deploy to GitHub Pages</strong> builds the Astro site, uploads a Pages artifact, and
							pushes it live.
						</li>
					</ul>
				</article>
				<article class="fact-card">
					<h3>üß≠ Traceable history</h3>
					<p>
						Each automated publish leaves behind a git commit, a GitHub Actions log, and a status change in
						Notion. That makes it easy to audit when and how each story shipped.
					</p>
				</article>
			</section>

			<section id="blog" class="timeline-section">
				<h2>The publishing lifecycle</h2>
				<p>
					From typing the first sentence to seeing it live takes five orchestrated steps. The timeline below
					breaks down what the automation does for me at every stage.
				</p>
				<WorkflowTimeline />
			</section>

			<section class="deep-dive">
				<h2>What happens under the hood?</h2>
				<p>
					Each component in the stack has a well-defined job. Together they eliminate copy-pasting, ensure
					content parity between Notion and Git, and keep deployment consistent.
				</p>
				<div class="grid">
					<article class="deep-card">
						<h3>Notion authoring</h3>
						<p>
							I draft directly in Notion where I can brainstorm, gather assets, and collaborate. Blocks
							get exported as Markdown, and frontmatter is generated automatically.
						</p>
						<ul>
							<li>Use headers, toggles, callouts‚Äîmost block types map cleanly to Markdown.</li>
							<li>
								Keep the ‚ÄúPreview Text‚Äù short; it becomes the summary used on the blog listing and in
								meta tags.
							</li>
						</ul>
					</article>
					<article class="deep-card">
						<h3>Conversion script</h3>
						<p>
							`scripts/publish.js` calls the Notion API with the official SDK and converts blocks via
							<code>notion-to-md</code>. It then builds frontmatter with title, description, publish dates,
							and tags.
						</p>
						<ul>
							<li>Files land in <code>src/content/blog/</code> ready for Astro Content Collections.</li>
							<li>
								After committing, it flips the Notion status to ‚ÄúPublished‚Äù to avoid duplicate exports.
							</li>
						</ul>
					</article>
					<article class="deep-card">
						<h3>Astro & GitHub Pages</h3>
						<p>
							Astro renders the blog with a cozy brown/beige theme. The deploy action bundles the static
							site, uploads it with <code>actions/upload-pages-artifact</code>, and publishes via Pages.
						</p>
						<ul>
							<li>Every commit is versioned. Rolling back is as easy as reverting a git SHA.</li>
							<li>No servers to manage‚ÄîPages handles global static hosting automatically.</li>
						</ul>
					</article>
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>
